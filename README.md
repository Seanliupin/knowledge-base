# 1. 项目由来
随着笔记越做越多，基于目录方式的管理方法已经逐渐不够用。虽然Evernote和有道云笔记已经可以方便地管理知识片段，但用了两年仍然感到不满足。比如，在学某门语言（ruby、java等）的时候，看到有作者用一小段代码很好地解释了语言的某个特性或者某种很好的用法，这时我会把这些优秀的代码段记录下来一遍以后查阅。那么，当以后需要查阅的时候，我希望我搜索的范围仅限于笔记中的各个代码段。

后来听到别人推荐Ulysses，它可以对笔记打tag标签，而搜索的时候可以将范围限定在标签、标题以及正文等，搜索粒度很细。这个功能比较赞。只是，这个app是收费软件。

作为一个做了大量笔记的人来说，我有着自己的痛点。当别人提供的工具没满足我的期望的时候，作为软件工程师，我决定自己DIY一个。同时因为我对知识管理这一问题一直有思考，因此，国庆的时候，花了四天时间写了这个版本。（不要被四天这个数字欺骗，在这四天之前，我对笔记管理这个问题至少有意无意地思考了两年。而国庆后，也修复了一些在使用中遇到的bug。这些可以在提交历史里看出。现在，我一直在用这个app来搜索我的笔记，Evernote基本不用了。）

# 2. 项目设计的思考
本质上，一则笔记就是一个微型网页。对这些笔记对组织，要么用雅虎的方式（目录），要么用google的方式（搜索）。越往后，笔记越来越多，唯一的选择只能是google的方式。

我要提供的，只是一个微型的知识库搜索引擎。

# 2.5 我对记笔记的一点感想
做笔记，本质上是在构建自己的知识库。做笔记的精髓，不是要大段地将别人的文章copy到你的知识库。而是，当你读到一篇博客，感觉很好，那就留下这个博客的地址，再写上自己的心得和评注。如此，一则简短的笔记就形成了。当读到一本书，可以根据章节目录，记录自己的读书心得和感悟。这又形成了一则笔记。我们需要在笔记中留下一些痕迹，以便以后可以很容易找到它们。

有些笔记过一段时间可能会过时。因此，经常检视自己的笔记是一个好习惯，删掉那些不再有用的东西。同时，对同一个问题的思考，过一段时间后可能会有不同的认识和答案。因此，有些笔记需要不断被重构。可能你就某个主题（比如如何高效学习）会写一篇笔记，等到三年后，你可能会有新的认识和感悟。因此，那时可以再回头重新修订这则笔记。十年后你又有了新的认识和感悟，到时再修订这则笔记。如此，知识库会随着你成长，以至于最后它就是你的一部分。

# 3. 项目设计的基本思路
从最终设计的结果来看，项目本身其实是定义了一种笔记的样板。
  1. 笔记有自己的标题
  2. 笔记可以有时间标签，以标明是什么时候写的笔记。
  3. 笔记可以有多个关键词。
  4. 笔记的正文可以包括：
    * 纯文本
    * 代码段
    * 列表
    * 特定的文本片段。（想法的源头：一行纯文本，不做任何说明就是正文。但是，还可以为它加一些属性。比如，标题就是一行文本加上标题的属性。代码段就是几行文本，外加一个属性，以说明这几行文本是代码段，而不是一般的文本。这一想法还可以继续扩展，以至于你可以为某几行连续的文本加上某个属性，以标明它是什么东西。在最终的设计中，用户可以将某段文本标记为诗歌或者备忘录等，用户可以随意定义一些文本片段的属性，然后在搜索的时候可以仅仅针对这些属性进行搜索。）
    * 对于想继续DIY的朋友，可以继续自定义自己的正文类型。不过，这需要写一些代码才行。
  5. 多篇笔记可以组织到一个文件中，在一个文件中的多个笔记可以共享一些关键词。

如此，当你想要新添加一篇笔记的时候，你不必纠结该把笔记放在哪里，放在任何你觉得恰当的地方就可以。因为，检索是基于内容进行的，笔记放在哪个文件夹下无关紧要。检索的时候，每一则笔记都会得到一个分数，且有如下原则：
  1. 如果笔记中不包括检索词，则得分为零。
  2. 如果笔记中包含检索词，则笔记会得到一个分数。对于检索词是英文的情况，不同情况有不同得分。比如，大小写完全匹配并且是全单词匹配，则得分最高。如果大小写不匹配但单词全匹配，得分次之。单词不完全匹配，得分再次之。这一算法的实现在代码中有，各种情况下的得分也只是大体设定的，不过目前够用了。
  3. 如果检索词出现在标题，会有一个得分，如果出现在关键词中，则有更高的得分。实际上，不同位置（标题，二级标题，关键词，代码段，正文，网址链接等）命中检索词的得分各不相同，而各部分的权重目前只是大体设定的（代码中有）。
  4. 一则笔记的最后得分是检索词在笔记中各个位置命中分数之和。

最终，一篇笔记可能长这样（假设笔记存放在text.md中，而text.md在哪个目录下无关紧要）：

#### 这是text.md的开始标识
globalTags: 测试 演示

## 笔记一
tags: 代码段的演示

一则笔记中，可以包含正文，时间标签，tag标签（也就是关键词标签，标签之间用空格相隔即可），代码段（以三个` `开始，可以制定代码段所属的语言，代码段的标题等 ），某一类型的文本段（以三个'开始，可以指定文本段的类型，比如备忘录，诗歌等，也可以指定文本段的标题）。

```ruby: 这是ruby代码段的正文
if params[:q].length > 3
render text: params[:q] * 4
end
```

'''memo: 这是一则读书心得
吴军的智能时代讲得很好。
我有如下启发：
1. 。。。
2. 。。。
'''


'''poem: 这是一首诗的标题
啊，大海
你真大
啊，月亮
你真圆
'''

## 笔记二
time: 2017/11/1
tags: 代码段的演示

这则笔记演示了为笔记加时间标签。

## 参考文献
  * [ruby官网](https://www.ruby-lang.org/en/)
  * [智能时代的链接](http://baidu.com)


#### 这是text.md的结束标识

# 4. 项目的使用
其实，该项目只是一个笔记的检索工具。我是这么做的：
  1. 用git创建了一个Note工程，将笔记托管到这个工程上。在电脑本地，会有一个Note目录对应这个工程。
  2. 用atom进行编辑。
  3. 运行本项目进行笔记搜索。（需要在工程中修改一个地方，将NoteBook.scala文件中的root变量改为你自己的Note目录即可）。因为该项目只是针对你所配置的目录进行搜索。因此，你完全可以不同git对笔记进行版本控制，你也可以完全不用atom来编辑笔记，选择你喜欢的文本编辑器就好了。对于有git版本控制的笔记，在搜索笔记文件的时候，程序会自动忽略掉隐藏的文件夹（即以.开头的文件夹）

项目是用scala语言写的，在命令行中，把工程clone下来后，切换到项目目录下，用sbt命令进入工程（第一次运行该命令的时候，可能需要下载一些依赖包，因此需要花一点时间）。运行sbt后，输入run命令，这个项目就跑起来了。在浏览器中输入http://localhost:9000，即可看到搜索页面。

还可以这样，输入sbt之后，再输入dist命令，之后在target/universal目录下会生成life-1.0-SNAPSHOT.zip。解压该文件并运行如下命令就可以在后台运行该程序了。

```bash
nohup ./life-1.0-SNAPSHOT/bin/life  -Dplay.http.secret.key=aboigtfrfghijk -Dhttp.port=9000 > log.md 2>&1 &
```

剩下的，就是在你的笔记中随意做笔记，然后就可以很愉快地进行搜索了。

# 5. 后续的扩展
如果愿意，还可以让笔记片段之间相互引用，并支持笔记之间的相互跳转。有兴趣的朋友可以自己尝试加入这个功能。

# 6. 一点说明
如果没有做大量笔记，可能体会不到搜索的需求。因为我的笔记里面包含了日记，读书感想，对技术的理解，读网页时对网页的评注，平时的一些奇思妙想，对产品设计的灵感，对某个主题资料的搜集等。这些全都可以轻松地组织在同一个知识库里面。目前的笔记条数有一千多条，即便笔记增加到上万条，目前的程序搜索速度也是极快的。

该程序的设计，并非仅仅根据检索词是否匹配来返回，它还根据匹配程度将结果排序。同时，可以方便地就某类信息进行搜索。比如，只在关键词中搜索，或者只在代码中搜索，或者只在标题中搜索等。这些对标了Ulysses，但又比Ulysses有更好的粒度控制。
